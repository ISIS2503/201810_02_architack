<html>
    <head>

        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- font awesome from BootstrapCDN -->
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">

        <!-- <link href="/css/app.css" rel="stylesheet"> -->

        <!-- CSS por Andres -->
        <link href="/css/dashboard.css" rel="stylesheet">
    </head>
    <body class="home">
        <div class="container">
        <table>
        <h1> Mapa de Residencias </h1>
        <div id="mapa2" class="container" >
        {% for x in residenciasUnidad %}
        <div class="row">
          <div>
            <img id="{{x.id}}img" src="https://image.ibb.co/cJTS0d/greenhouse.png" alt="Imagen Casa Verde" height="200" width="200">
            <p class="textoAlarma" id="{{x.id}}texto">Sin alarmas!</p>
          </div>
        </div>
        {% endfor %}
        </div>
        </table>
        </div>
        <script>
        var mqtt;
                  var reconnectTimeout = 2000;

                  function onConnect(){
                  console.log("Se conecto");
                      mqtt.subscribe("#");
                  }

                   function MQTTconnect(){

                      console.log("ENTRO A MQTTconnect");
                      mqtt = new Paho.MQTT.Client("172.24.41.163", 9001, null);
                      var options = {
                      timeout:3,
                      onSuccess: onConnect,
                      onFailure: onFailure,
                      };
                      mqtt.onMessageArrived = onMessageArrived;
                      mqtt.connect(options);
                      client.setCallback(new MqttCallback() {
                      function connectionLost(Throwable cause) {}
                      function messageArrived(String topic, MqttMessage message) throws Exception {
                  }
                  });
                  }

                  function onFailure(message){
                      setTimeout(MQTTconnect, reconnectTimeout);
                  }

                  function onMessageArrived(msg){

                      console.log("Llego algo");
                      console.log(msg.destinationName);

                  }
        </script>
        <script> MQTTconnect(); </script>
    </body>
</html>
